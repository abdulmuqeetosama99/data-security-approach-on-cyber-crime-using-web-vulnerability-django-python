from django.db.models import Count
from django.shortcuts import render, redirect, get_object_or_404
from django.shortcuts import render,HttpResponseRedirect
from django.contrib import messages
from django.contrib import auth
from django.contrib.auth import authenticate
from django.contrib.auth.models import User
# Create your views here.
from email_admin.models import SpamModel
from user.models import RegisterModel, SendmailModel, FeedbackModel


def login(request):
    username = request.POST.get('username','')
    password = request.POST.get('password','')
    user =auth.authenticate(username=username,password=password)
    if user is not None and user.is_active:
        auth.login(request,user)
        request.session['userid']= username
        print("hi request.session['username']")
        return HttpResponseRedirect('/')
    return render(request,'email_admin/login_page.html')

def logout(request):
    auth.logout(request)
    #del request.session['username']
    return HttpResponseRedirect("/")

def admin_page(request):
    obj=RegisterModel.objects.all()
    return render(request,'email_admin/admin_page.html',{'objects':obj})

def analysis_page(request):
    obj=SendmailModel.objects.all()

    return render(request,'email_admin/analysis_page.html',{'obj':obj})

def analysisdelete(request,pk):

    obj = get_object_or_404(SendmailModel, pk=pk)
    obj.delete()
    return redirect('analysis_page')
def categoryanalysis_chart(request,chart_type):
    chart = SendmailModel.objects.values('category').annotate(dcount=Count('category'))
    return render(request,'email_admin/chart.html',{'objects':chart,'chart_type':chart_type})

def viewfeedback(request):
    obj = FeedbackModel.objects.all()
    return render(request,'email_admin/viewfeedback.html',{'object':obj})


